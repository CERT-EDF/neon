<section>
  <div class="my-8 px-4 md:px-16 flex items-center justify-between mx-auto">
    <img class="h-20" src="favicon.png" routerLink="/" />

    <div class="flex items-center gap-4">
      <p-button icon="pi pi-folder-plus" (click)="openAddCaseModal()" text severity="primary" />
      <p-button icon="pi pi-bars" (click)="menu.toggle($event)" text />
    </div>
  </div>
</section>

<section class="my-4 px-4 md:px-16 max-w-full mx-auto">
  <div class="flex justify-center">
    <div class="w-80">
      <input id="searchInput" [formControl]="searchInput" pInputText placeholder="Filter..." fluid />
    </div>
  </div>

  <div class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4 slide-y">
    @defer () {
    @for (case of displayedCases; track case.guid) {
    <p-card class="relative rounded-xl cursor-pointer h-full slide-y" [routerLink]="'/case/' + case.guid">
      <div class="p-2 flex flex-col gap-1">
        <div class="shrink text-sm text-slate-300">#{{ case.tsid || 'N/A' }}</div>
        <div class="flex items-center gap-2 text-lg font-bold truncate">{{ case.name }} @if (case.closed) {<span
            class="bg-red-100 text-red-800 text-center text-xs font-medium px-2.5 py-0.5 rounded dark:bg-red-500 dark:text-red-100">
            closed</span>}</div>
        <div class="text-slate-400 text-sm truncate">{{ case.created | date: "y-MM-dd" }}</div>
      </div>

      <div class="px-2 mt-2 line-clamp-1">
        {{ case.description || 'No description' }}
      </div>

      @if (case.unseenNew) {
      <div
        class="absolute text-sm text-white px-4 py-1 top-0 -translate-y-1 left-0 -translate-x-1 bg-blue-400 rounded shadow">
        NEW</div>
      }

      <div class="mt-2 p-2 flex items-center justify-around">
        @if (case.acs.length) {
        <div
          class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-gray-500 dark:text-gray-100">
          {{ case.acs.length === 1 ? case.acs[0] : 'Multiple' }}</div>
        } @else {
        <div
          class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-500 dark:text-green-100">
          Public</div>
        }
      </div>
    </p-card>
    } @empty {
    <div class="flex justify-center mt-8 col-span-full">
      <div class="py-8 px-4 mx-auto max-w-screen-xl sm:py-16 lg:px-6">
        <div class="max-w-screen-md">
          <div class="flex justify-center items-center">
            <h2 class="mb-0 text-4xl tracking-tight font-extrabold text-gray-700">
              Nothing to see yet
            </h2>
          </div>
          <p class="mt-4 font-light text-center text-gray-500 sm:text-xl">
            Create your first case
          </p>

          <div class="mt-4 text-center">
            <p-button label="Create" (click)="openAddCaseModal()" text severity="help" />
          </div>
        </div>
      </div>
    </div>
    }
    } @placeholder (minimum 0.4s) {
    @for (_ of [1,2,3]; track _) {
    <p-skeleton class="w-full" height="10rem"></p-skeleton>
    }
    }
  </div>
</section>

<p-menu #menu [model]="menuItems" [popup]="true" />

<p-dialog header="About" [dismissableMask]="true" [modal]="true" [(visible)]="isAboutDialogVisible">
  <div class="flex flex-col gap-2">
    <span>Collaborative malware database management <span class="text-sm text-gray-500">v{{ (info$ | async)?.version
        }}</span></span>
    <span>Frontend <span class="text-sm text-gray-500">v{{ frontendVersion }}</span></span>
    @if (frontendVersion != (info$|async)?.version) { <div class="text-center font-semibold text-red-500">Versions for
      frontend and backend don't match!</div> }
    <span class="mt-4 text-xs text-center text-gray-500">Powered by CERT EDF âš¡</span>
  </div>
</p-dialog>